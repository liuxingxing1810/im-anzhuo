# æ˜Ÿæ˜ŸIM æœ¬åœ°æ•°æ®åº“æ¶æ„è®¾è®¡

> æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š2025-12-10
> 
> æœ¬æ–‡æ¡£è°ƒç ”äº†å¾®ä¿¡ã€Telegramã€WhatsApp ç­‰ä¸»æµ IM åº”ç”¨çš„æœ¬åœ°æ•°æ®åº“æ¶æ„è®¾è®¡æ–¹æ¡ˆï¼Œä¸ºæ˜Ÿæ˜ŸIM æä¾›æ¶æ„å‚è€ƒã€‚

---

## ä¸€ã€ç°çŠ¶åˆ†æ

### 1.1 å½“å‰é¡¹ç›®å·²æœ‰çš„æ•°æ®åº“ç»“æ„

æ˜Ÿæ˜ŸIM å·²ç»ä½¿ç”¨ **Room Database** åˆ›å»ºäº†åŸºç¡€çš„æœ¬åœ°æ•°æ®åº“æ¡†æ¶ï¼š

```kotlin
// ä½ç½®: core/data/src/main/java/com/aurora/wave/data/database/WaveDatabase.kt
@Database(
    entities = [
        MessageEntity::class,      // æ¶ˆæ¯è¡¨
        ConversationEntity::class, // ä¼šè¯è¡¨
        UserEntity::class          // ç”¨æˆ·è¡¨
    ],
    version = 1,
    exportSchema = true
)
```

**ç°æœ‰è¡¨ç»“æ„ï¼š**

| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ |
|------|------|----------|
| `messages` | æ¶ˆæ¯è®°å½• | id, conversationId, senderId, type, content, timestamp, deliveryStatus, isDeleted |
| `conversations` | ä¼šè¯åˆ—è¡¨ | id, type, name, lastMessage, unreadCount, isPinned, isMuted |
| `users` | ç”¨æˆ·ä¿¡æ¯ | id, displayName, avatarUrl, username, isContact, isBlocked |

---

## äºŒã€å¤§å‚ IM æœ¬åœ°å­˜å‚¨æ¶æ„ç ”ç©¶

### 2.1 å¾®ä¿¡ (WeChat) æ¶æ„

å¾®ä¿¡æ˜¯å…¨çƒç”¨æˆ·é‡æœ€å¤§çš„ IM åº”ç”¨ï¼Œå…¶æœ¬åœ°å­˜å‚¨æ¶æ„éå¸¸æˆç†Ÿï¼š

#### æ•°æ®åº“é€‰å‹
- **SQLite** (åŠ å¯†ç‰ˆ SQLCipher)
- ä½¿ç”¨ WCDB (å¾®ä¿¡è‡ªç ”çš„æ•°æ®åº“æ¡†æ¶)
- æ”¯æŒå¤šè¿›ç¨‹è®¿é—®

#### æ ¸å¿ƒè¡¨ç»“æ„
```
â”œâ”€â”€ message          # æ¶ˆæ¯è¡¨ (æŒ‰ä¼šè¯åˆ†è¡¨æˆ–åˆ†åº“)
â”œâ”€â”€ conversation     # ä¼šè¯è¡¨
â”œâ”€â”€ contact          # è”ç³»äººè¡¨
â”œâ”€â”€ chatroom         # ç¾¤èŠä¿¡æ¯è¡¨
â”œâ”€â”€ media            # åª’ä½“æ–‡ä»¶ç´¢å¼•è¡¨
â”œâ”€â”€ emoji            # è¡¨æƒ…åŒ…è¡¨
â”œâ”€â”€ fts_message      # å…¨æ–‡æœç´¢ç´¢å¼•è¡¨
â””â”€â”€ sync_key         # å¢é‡åŒæ­¥é”šç‚¹è¡¨
```

#### å…³é”®è®¾è®¡è¦ç‚¹
1. **æ¶ˆæ¯åˆ†åº“** - æŒ‰ä¼šè¯IDå“ˆå¸Œåˆ†åº“ï¼Œé¿å…å•è¡¨è¿‡å¤§
2. **å¢é‡åŒæ­¥** - ç»´æŠ¤ sync_keyï¼Œåªæ‹‰å–å¢é‡æ¶ˆæ¯
3. **åª’ä½“åˆ†ç¦»** - å›¾ç‰‡/è§†é¢‘/æ–‡ä»¶ åªå­˜ç´¢å¼•ï¼ŒåŸæ–‡ä»¶å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿ
4. **åŒå‘å¼•ç”¨** - æ¶ˆæ¯æ—¢å¯é€šè¿‡ä¼šè¯æŸ¥ï¼Œä¹Ÿæ”¯æŒå…¨å±€æœç´¢

---

### 2.2 Telegram æ¶æ„

Telegram ä»¥é€Ÿåº¦å¿«ã€äº‘åŒæ­¥è‘—ç§°ï¼Œå…¶æ¶æ„æ›´åå‘ "äº‘ä¼˜å…ˆ"ï¼š

#### å­˜å‚¨ç­–ç•¥
- **SQLite** æœ¬åœ°å­˜å‚¨
- äº‘ç«¯æ˜¯ä¸»æ•°æ®æºï¼Œæœ¬åœ°æ˜¯ç¼“å­˜
- æ”¯æŒè·¨è®¾å¤‡å®æ—¶åŒæ­¥

#### æ ¸å¿ƒè®¾è®¡
```
â”œâ”€â”€ dialogs          # ä¼šè¯åˆ—è¡¨ï¼ˆå¯¹åº”æˆ‘ä»¬çš„ conversationsï¼‰
â”œâ”€â”€ messages         # æ¶ˆæ¯ç¼“å­˜
â”œâ”€â”€ users            # ç”¨æˆ·ä¿¡æ¯ç¼“å­˜
â”œâ”€â”€ chats            # ç¾¤ç»„ä¿¡æ¯
â”œâ”€â”€ media_cache      # åª’ä½“ç¼“å­˜ç´¢å¼•
â”œâ”€â”€ draft            # è‰ç¨¿ç®±
â””â”€â”€ pts_state        # åŒæ­¥çŠ¶æ€ç‚¹
```

#### å…³é”®ç‰¹ç‚¹
1. **PTS æœºåˆ¶** - ä½¿ç”¨ pts (Points) è¿½è¸ªåŒæ­¥çŠ¶æ€
2. **æ‡’åŠ è½½** - æ—§æ¶ˆæ¯æŒ‰éœ€ä»äº‘ç«¯æ‹‰å–ï¼Œä¸å…¨é‡ä¸‹è½½
3. **åª’ä½“ç¼“å­˜** - å¯é…ç½®è‡ªåŠ¨ä¸‹è½½ç­–ç•¥ï¼ˆWiFi/ç§»åŠ¨ç½‘ç»œ/æ¼«æ¸¸ï¼‰
4. **å³æ—¶åˆ é™¤** - æœåŠ¡ç«¯åˆ é™¤ï¼Œæœ¬åœ°ç«‹å³åŒæ­¥åˆ é™¤

---

### 2.3 WhatsApp æ¶æ„

WhatsApp ç‰¹ç‚¹æ˜¯ç«¯åˆ°ç«¯åŠ å¯†ï¼š

#### å­˜å‚¨ç­–ç•¥
- **SQLite** (åŠ å¯†)
- å¼ºè°ƒæœ¬åœ°ä¼˜å…ˆï¼Œå¤‡ä»½åˆ° Google Drive/iCloud

#### æ•°æ®ç»“æ„
```
â”œâ”€â”€ messages         # æ¶ˆæ¯è¡¨
â”œâ”€â”€ message_media    # åª’ä½“æ¶ˆæ¯è¯¦æƒ…
â”œâ”€â”€ chat_list        # èŠå¤©åˆ—è¡¨
â”œâ”€â”€ contacts         # è”ç³»äºº
â”œâ”€â”€ group_participants # ç¾¤æˆå‘˜
â”œâ”€â”€ status           # çŠ¶æ€/æœ‹å‹åœˆ
â””â”€â”€ settings         # è®¾ç½®
```

#### å…³é”®è®¾è®¡
1. **æ¶ˆæ¯IDè®¾è®¡** - ä½¿ç”¨ `phone_jid + timestamp + random` ç”Ÿæˆ
2. **åª’ä½“åˆ†çº§å­˜å‚¨** - ç¼©ç•¥å›¾ DB å­˜å‚¨ï¼ŒåŸå›¾æ–‡ä»¶ç³»ç»Ÿ
3. **ç«¯åˆ°ç«¯åŠ å¯†** - æ¶ˆæ¯åŠ å¯†åå­˜å‚¨ï¼Œå¯†é’¥æœ¬åœ°ä¿ç®¡

---

## ä¸‰ã€æ¶ˆæ¯åŒæ­¥æœºåˆ¶è¯¦è§£

### 3.1 æ ¸å¿ƒé—®é¢˜
> "èŠå¤©è®°å½•åº”è¯¥æ˜¯è¯·æ±‚ä¸€æ¬¡å°±å­˜åœ¨æœ¬åœ°äº†å§ï¼Ÿ"

**æ˜¯çš„ï¼Œä½ çš„ç†è§£åŸºæœ¬æ­£ç¡®ï¼** ç°ä»£ IM é‡‡ç”¨çš„æ˜¯ **"å†™å…¥å³æŒä¹…åŒ–"** ç­–ç•¥ï¼š

```
å‘é€æ¶ˆæ¯æµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â‘ å‘é€    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â‘¡å­˜å‚¨    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·A  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  æœåŠ¡å™¨  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  æ•°æ®åº“  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ â‘¢æ¨é€
                            â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â‘£æœ¬åœ°å­˜å‚¨  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  ç”¨æˆ·B  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ æœ¬åœ°SQLite â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 åŒæ­¥ç­–ç•¥å¯¹æ¯”

| ç­–ç•¥ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **æœ¬åœ°ä¼˜å…ˆ** | å¿«é€Ÿã€ç¦»çº¿å¯ç”¨ | å¤šç«¯åŒæ­¥å¤æ‚ | å¾®ä¿¡ã€WhatsApp |
| **äº‘ä¼˜å…ˆ** | å¤šç«¯ä¸€è‡´ã€çœç©ºé—´ | ä¾èµ–ç½‘ç»œ | Telegram |
| **æ··åˆç­–ç•¥** | å¹³è¡¡ä½“éªŒå’Œä¸€è‡´æ€§ | å®ç°å¤æ‚ | ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ |

### 3.3 æ¨èæ–¹æ¡ˆï¼šæœ¬åœ°ä¼˜å…ˆ + å¢é‡åŒæ­¥

```
åˆæ¬¡ç™»å½•/é‡æ–°å®‰è£…:
1. æ‹‰å–ä¼šè¯åˆ—è¡¨ (conversations)
2. æ‹‰å–æ¯ä¸ªä¼šè¯æœ€è¿‘ N æ¡æ¶ˆæ¯ (å¦‚æœ€è¿‘ 30 æ¡)
3. åç»­æ¶ˆæ¯é€šè¿‡é•¿è¿æ¥å®æ—¶æ¨é€

å·²ç™»å½•çŠ¶æ€:
1. WebSocket å®æ—¶æ¥æ”¶æ–°æ¶ˆæ¯
2. æ¶ˆæ¯åˆ°è¾¾ç«‹å³å†™å…¥æœ¬åœ°æ•°æ®åº“
3. UI ç›‘å¬æ•°æ®åº“å˜åŒ–è‡ªåŠ¨æ›´æ–°

ç¦»çº¿æ¶ˆæ¯å¤„ç†:
1. ä¸Šçº¿æ—¶ï¼ŒæœåŠ¡å™¨æ¨é€ç¦»çº¿æœŸé—´çš„æ¶ˆæ¯
2. ä½¿ç”¨ lastSyncTimestamp æ ‡è®°åŒæ­¥ç‚¹
3. æ‰¹é‡å†™å…¥æœ¬åœ°æ•°æ®åº“
```

---

## å››ã€éœ€è¦é‡æ–°æ‹‰å–çš„åœºæ™¯

### 4.1 å¼ºåˆ¶é‡æ–°åŒæ­¥çš„æƒ…å†µ

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|----------|
| **æ¶ˆæ¯æ’¤å›** | æœåŠ¡ç«¯æ¨é€æ’¤å›äº‹ä»¶ï¼Œæœ¬åœ°æ ‡è®° `isDeleted = true` æˆ–åˆ é™¤ |
| **æ¶ˆæ¯ç¼–è¾‘** | æœåŠ¡ç«¯æ¨é€ç¼–è¾‘äº‹ä»¶ï¼Œæœ¬åœ°æ›´æ–° content å’Œ editedAt |
| **åˆ é™¤Appé‡è£…** | å…¨é‡æ‹‰å–ä¼šè¯åˆ—è¡¨ + æ¯ä¼šè¯æœ€è¿‘æ¶ˆæ¯ |
| **åˆ‡æ¢è®¾å¤‡** | åŒä¸Šï¼Œå¯é€‰æ‹©æ˜¯å¦æ¢å¤å†å² |
| **æ¸…é™¤ç¼“å­˜** | è§¦å‘å¢é‡åŒæ­¥ï¼Œä»æœåŠ¡ç«¯æ¢å¤æ•°æ® |

### 4.2 åŒæ­¥é”šç‚¹è®¾è®¡

```kotlin
// å»ºè®®æ–°å¢è¡¨ï¼šåŒæ­¥çŠ¶æ€è¡¨
@Entity(tableName = "sync_state")
data class SyncStateEntity(
    @PrimaryKey
    val conversationId: String,  // ä¼šè¯IDï¼Œ"global" è¡¨ç¤ºå…¨å±€
    val lastSyncTimestamp: Long, // ä¸Šæ¬¡åŒæ­¥æ—¶é—´æˆ³
    val serverSeq: Long?,        // æœåŠ¡ç«¯åºåˆ—å·
    val localSeq: Long?,         // æœ¬åœ°åºåˆ—å·
    val syncStatus: SyncStatus   // SYNCED, SYNCING, PENDING
)
```

---

## äº”ã€åª’ä½“æ–‡ä»¶å­˜å‚¨ç­–ç•¥

### 5.1 åˆ†å±‚å­˜å‚¨æ¶æ„

```
/data/data/com.aurora.wave/
â”œâ”€â”€ databases/
â”‚   â””â”€â”€ wave_database.db       # SQLite ä¸»æ•°æ®åº“
â”œâ”€â”€ files/
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ original/          # åŸå›¾
â”‚   â”‚   â””â”€â”€ thumbnails/        # ç¼©ç•¥å›¾
â”‚   â”œâ”€â”€ videos/
â”‚   â”‚   â”œâ”€â”€ original/
â”‚   â”‚   â””â”€â”€ thumbnails/
â”‚   â”œâ”€â”€ audio/
â”‚   â”œâ”€â”€ documents/
â”‚   â””â”€â”€ stickers/
â””â”€â”€ cache/
    â””â”€â”€ media_cache/           # ä¸´æ—¶åª’ä½“ç¼“å­˜
```

### 5.2 åª’ä½“ç´¢å¼•è¡¨è®¾è®¡

```kotlin
// å»ºè®®æ–°å¢è¡¨ï¼šåª’ä½“æ–‡ä»¶è¡¨
@Entity(tableName = "media_files")
data class MediaFileEntity(
    @PrimaryKey
    val id: String,
    val messageId: String,       // å…³è”æ¶ˆæ¯
    val conversationId: String,  // å…³è”ä¼šè¯
    val type: MediaType,         // IMAGE, VIDEO, AUDIO, DOCUMENT
    val fileName: String,        // æ–‡ä»¶å
    val fileSize: Long,          // æ–‡ä»¶å¤§å° (bytes)
    val mimeType: String,        // MIME ç±»å‹
    val localPath: String?,      // æœ¬åœ°è·¯å¾„ (ä¸‹è½½å)
    val remotePath: String,      // æœåŠ¡å™¨è·¯å¾„/URL
    val thumbnailPath: String?,  // ç¼©ç•¥å›¾æœ¬åœ°è·¯å¾„
    val downloadStatus: DownloadStatus, // PENDING, DOWNLOADING, COMPLETED, FAILED
    val uploadStatus: UploadStatus,     // ç”¨äºå‘é€
    val width: Int?,             // å›¾ç‰‡/è§†é¢‘å®½åº¦
    val height: Int?,            // å›¾ç‰‡/è§†é¢‘é«˜åº¦
    val duration: Long?,         // éŸ³è§†é¢‘æ—¶é•¿ (ms)
    val createdAt: Long
)
```

### 5.3 è‡ªåŠ¨ä¸‹è½½ç­–ç•¥

```kotlin
// å»ºè®®æ–°å¢è¡¨ï¼šä¸‹è½½è®¾ç½®
data class MediaDownloadSettings(
    val autoDownloadImages: Boolean = true,
    val autoDownloadVideos: Boolean = false,  // è§†é¢‘å¤§ï¼Œé»˜è®¤ä¸è‡ªåŠ¨
    val autoDownloadAudio: Boolean = true,
    val autoDownloadDocuments: Boolean = false,
    val maxAutoDownloadSize: Long = 10 * 1024 * 1024,  // 10MB
    val wifiOnly: Boolean = false  // ä»… WiFi è‡ªåŠ¨ä¸‹è½½
)
```

---

## å…­ã€å®Œæ•´æ•°æ®åº“ Schema å»ºè®®

### 6.1 å…¨éƒ¨è¡¨ç»“æ„

```kotlin
@Database(
    entities = [
        // æ ¸å¿ƒè¡¨ï¼ˆç°æœ‰ï¼‰
        MessageEntity::class,
        ConversationEntity::class,
        UserEntity::class,
        
        // å»ºè®®æ–°å¢
        MediaFileEntity::class,      // åª’ä½“æ–‡ä»¶
        SyncStateEntity::class,      // åŒæ­¥çŠ¶æ€
        DraftEntity::class,          // è‰ç¨¿
        ReactionEntity::class,       // æ¶ˆæ¯ååº”
        MentionEntity::class,        // @æåŠ
        PinnedMessageEntity::class,  // ç½®é¡¶æ¶ˆæ¯
        SearchHistoryEntity::class,  // æœç´¢å†å²
        BlockedUserEntity::class,    // é»‘åå•
    ],
    version = 2,
    exportSchema = true
)
abstract class WaveDatabase : RoomDatabase()
```

### 6.2 ER å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     users       â”‚       â”‚  conversations  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)         â”‚       â”‚ id (PK)         â”‚
â”‚ displayName     â”‚â”€â”€â”    â”‚ type            â”‚
â”‚ avatarUrl       â”‚  â”‚    â”‚ name            â”‚
â”‚ isContact       â”‚  â”‚    â”‚ lastMessage     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚ unreadCount     â”‚
                     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚             â”‚
                     â”‚             â”‚ 1:N
                     â”‚             â–¼
                     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚    â”‚    messages     â”‚
                     â””â”€â”€â”€>â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                          â”‚ id (PK)         â”‚
                          â”‚ conversationId  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ senderId (FK)   â”‚          â”‚
                          â”‚ type            â”‚          â”‚
                          â”‚ content         â”‚          â”‚
                          â”‚ timestamp       â”‚          â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                                   â”‚                   â”‚
                                   â”‚ 1:N               â”‚
                                   â–¼                   â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
                          â”‚  media_files    â”‚          â”‚
                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚
                          â”‚ id (PK)         â”‚          â”‚
                          â”‚ messageId (FK)  â”‚          â”‚
                          â”‚ conversationId  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ localPath       â”‚
                          â”‚ remotePath      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸ƒã€å®ç°ä¼˜å…ˆçº§å»ºè®®

### Phase 1 - åŸºç¡€å®Œå–„ (å½“å‰)
- [x] messages è¡¨åŸºç¡€ç»“æ„
- [x] conversations è¡¨åŸºç¡€ç»“æ„
- [x] users è¡¨åŸºç¡€ç»“æ„
- [ ] æ·»åŠ  sync_state è¡¨
- [ ] å®Œå–„æ¶ˆæ¯å·²è¯»çŠ¶æ€åŒæ­¥

### Phase 2 - åª’ä½“æ”¯æŒ
- [ ] æ·»åŠ  media_files è¡¨
- [ ] å®ç°å›¾ç‰‡æ¶ˆæ¯å‘é€/æ¥æ”¶
- [ ] å®ç°ç¼©ç•¥å›¾ç”Ÿæˆ
- [ ] å®ç°ä¸‹è½½ç®¡ç†å™¨

### Phase 3 - é«˜çº§åŠŸèƒ½
- [ ] å…¨æ–‡æœç´¢ (FTS)
- [ ] æ¶ˆæ¯å¼•ç”¨/å›å¤
- [ ] æ¶ˆæ¯ååº” (Reactions)
- [ ] æ¶ˆæ¯æ’¤å›

### Phase 4 - æ€§èƒ½ä¼˜åŒ–
- [ ] æ¶ˆæ¯åˆ†é¡µåŠ è½½
- [ ] æ•°æ®åº“åŠ å¯† (SQLCipher)
- [ ] å¤§ä¼šè¯æ¶ˆæ¯å½’æ¡£

---

## å…«ã€æŠ€æœ¯é€‰å‹å»ºè®®

### 8.1 æ•°æ®åº“æ¡†æ¶
| é€‰é¡¹ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|------|------|------|--------|
| **Room** (å½“å‰) | å®˜æ–¹æ”¯æŒã€æ˜“ç”¨ | æ€§èƒ½ä¸€èˆ¬ | â­â­â­â­ |
| SQLDelight | è·¨å¹³å°ã€ç±»å‹å®‰å…¨ | å­¦ä¹ æ›²çº¿ | â­â­â­ |
| Realm | é«˜æ€§èƒ½ã€å®æ—¶åŒæ­¥ | åŒ…ä½“ç§¯å¤§ | â­â­â­ |

**å»ºè®®ï¼šç»§ç»­ä½¿ç”¨ Roomï¼Œæ»¡è¶³å½“å‰éœ€æ±‚ã€‚**

### 8.2 ç½‘ç»œåŒæ­¥
| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| WebSocket | å®æ—¶æ¶ˆæ¯æ¨é€ (æ¨è) |
| MQTT | è½»é‡çº§ï¼Œé€‚åˆç§»åŠ¨ç«¯ |
| Firebase FCM | æ¨é€é€šçŸ¥ |

### 8.3 æ–‡ä»¶å­˜å‚¨
- å°æ–‡ä»¶ (< 1MB): å¯è€ƒè™‘ Base64 å­˜æ•°æ®åº“
- å¤§æ–‡ä»¶: å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œæ•°æ®åº“åªå­˜ç´¢å¼•

---

## ä¹ã€å¾…è®¨è®ºé—®é¢˜

1. **æ¶ˆæ¯ä¿å­˜ç­–ç•¥**
   - ä¿å­˜å¤šä¹…ï¼Ÿ(å¾®ä¿¡æ— é™åˆ¶ï¼ŒTelegram äº‘ç«¯æ°¸ä¹…)æœ¬åœ°æ°¸ä¹…,äº‘ç«¯æ°¸ä¹…
   - æ˜¯å¦æ”¯æŒå¯¼å‡ºèŠå¤©è®°å½•ï¼Ÿä¸æ”¯æŒ

2. **å¤šç«¯åŒæ­¥**
   - æ˜¯å¦æ”¯æŒ PC/Web ç«¯ï¼ŸåŒæ­¥
   - åŒæ­¥ç­–ç•¥å¦‚ä½•è®¾è®¡ï¼Ÿä½ æ¥è®¾è®¡,çœ‹çœ‹å¤§å‚å¦‚ä½•å®ç°å¤šç«¯åŒæ­¥çš„

3. **ç¦»çº¿æ¶ˆæ¯é™åˆ¶**
   - æœ€å¤šç¼“å­˜å¤šå°‘æ¡ç¦»çº¿æ¶ˆæ¯ï¼Ÿæ— é™åˆ¶
   - è¶…å‡ºåå¦‚ä½•å¤„ç†ï¼Ÿ åˆ é™¤æœ€æ—©çš„æ¶ˆæ¯

4. **åŠ å¯†æ–¹æ¡ˆ**
   - æ˜¯å¦éœ€è¦ç«¯åˆ°ç«¯åŠ å¯†ï¼Ÿéœ€è¦,é˜²æ­¢è¢«ç›‘å¬,é˜²æ­¢è¢«æŠ“åˆ°å…³é”®å­—
   - æœ¬åœ°æ•°æ®åº“æ˜¯å¦åŠ å¯†ï¼ŸåŠ å¯†

5. **å¤‡ä»½æ¢å¤**
   - æ”¯æŒå¤‡ä»½åˆ°äº‘ç«¯å—ï¼ŸæœåŠ¡å™¨æœ¬æ¥å°±æœ‰ä¿å­˜  æœ¬åœ°æ²¡æœ‰èŠå¤©è®°å½•å°±è¦ä»æœåŠ¡å™¨æ‹‰ç¬¬ä¸€é¡µçš„èŠå¤©åˆ—è¡¨å’Œè¯¥åˆ—è¡¨çš„æ¯ä¸ªä¼šè¯çª—å£çš„æœ€æ–°çš„50æ¡
   - æ¢æœºè¿ç§»æ–¹æ¡ˆï¼ŸåŒä¸Š

---

## åã€å‚è€ƒèµ„æ–™

1. [å¾®ä¿¡ WCDB å¼€æºé¡¹ç›®](https://github.com/nickhsine/wcdb)
2. [Telegram TDLib æ–‡æ¡£](https://core.telegram.org/tdlib)
3. [Signal Protocol ç«¯åˆ°ç«¯åŠ å¯†](https://signal.org/docs/)
4. [Android Room å®˜æ–¹æ–‡æ¡£](https://developer.android.com/training/data-storage/room)

---

> ğŸ’¡ **ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼šè¯·å®¡é˜…æœ¬æ–‡æ¡£ï¼Œç¡®å®šä¼˜å…ˆå®ç°çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹é€æ­¥å®Œå–„æ•°æ®åº“æ¶æ„ã€‚
